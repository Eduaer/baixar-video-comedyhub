<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>ComedyHub Downloader</title>
  <!-- Import corrigido pelo unpkg -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
</head>
<body style="font-family: Arial; text-align: center; margin-top: 50px;">

  <h2>Baixar meme do ComedyHub</h2>
  <input id="urlInput" type="text" size="60" placeholder="Cole aqui o link do meme">
  <button onclick="baixar()">Gerar e Baixar</button>

  <p id="status"></p>

  <script>
    async function baixar() {
      const input = document.getElementById("urlInput").value.trim();
      const status = document.getElementById("status");
      if (!input.includes("/meme/")) {
        status.innerText = "‚ö†Ô∏è Link inv√°lido!";
        return;
      }

      const id = input.split("/meme/")[1];
      let m3u8Url = `https://comedyhub.b-cdn.net/memes/${id}/${id}.m3u8`;

      // se precisar usar proxy (CORS), descomenta:
      // m3u8Url = "https://weathered-breeze-e67b.duduuuu863.workers.dev/?url=" + encodeURIComponent(m3u8Url);

      status.innerText = "üîÑ Baixando e convertendo... aguarde";

      const ffmpeg = FFmpeg.createFFmpeg({ log: true });
      await ffmpeg.load();

      const res = await fetch(m3u8Url);
      if (!res.ok) {
        status.innerText = "‚ùå N√£o foi poss√≠vel baixar o .m3u8";
        return;
      }
      const data = await res.arrayBuffer();
      await ffmpeg.FS("writeFile", "video.m3u8", new Uint8Array(data));

      await ffmpeg.run("-i", "video.m3u8", "-c", "copy", "saida.mp4");
      const mp4Data = ffmpeg.FS("readFile", "saida.mp4");

      const blob = new Blob([mp4Data.buffer], { type: "video/mp4" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = id + ".mp4";
      a.click();

      status.innerText = "‚úÖ Download pronto!";
    }
  </script>
</body>
</html>
